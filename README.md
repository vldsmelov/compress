# Микросервисный стек контрактного анализа

Набор сервисов на FastAPI и Vite, которые взаимодействуют через HTTP внутри общей Docker-сети и доступны с хоста по `localhost`. Стек включает извлечение данных из договоров, юридическую и экономическую проверку, нарезку документов и административную панель.

## Состав сервисов
- **ai_sb** — контрактный экстрактор (sb_check_service) на FastAPI.
- **ai_econom** — экономический анализ договоров.
- **ai_legal** — проверка и подготовка разделов договора.
- **document_slice** — нарезка документов и проксирование запросов к остальным сервисам.
- **admin-panel** — веб-интерфейс для работы с сервисами.
- **ollama_ext** — LLM-бэкенд Ollama, доступный для остальных контейнеров.

## Быстрый старт
1. Убедитесь, что Docker установлен.
2. Соберите и запустите все сервисы:

```bash
   docker compose up -d --build
   ```
3. Доступные точки входа с хоста:
   - Контрактный экстрактор: http://localhost:8085
   - Document slicer: http://localhost:8090
   - Admin-panel: http://localhost:8091
   - AI Legal: http://localhost:8092
   - Ollama: http://localhost:11434

Сервисы взаимодействуют друг с другом внутри сети compose по именам контейнеров, при этом конечные точки остаются доступными на `localhost` для разработки и интеграции.

## Структура репозитория
```
services/
  ai_sb/               # контрактный экстрактор и его зависимости
  ai_econom/           # экономический анализ
  ai_legal/            # юридический анализ
  document_slice/      # сервис нарезки и маршрутизации запросов
  admin-panel/         # фронтенд панель управления
docker-compose.yml     # корневой compose-файл
```


Каждый сервис содержит свой Dockerfile, требования и код. Настройки Ollama по умолчанию указывают на контейнер `ollama_ext` (http://ollama_ext:11434). При необходимости используйте переменные окружения из `docker-compose.yml` для подмены модели или таймаутов.

## Основные эндпоинты контрактного экстрактора
- `GET /healthz` — проверка живости.
- `POST /check` — извлечение данных из текста.
- `POST /qa` — ответы на произвольные вопросы к разделам.
- `POST /qa/docx` — загрузка DOCX и выполнение преднастроенных планов вопросов.

Готовые планы хранятся в `services/ai_sb/app/assets/qa_plans/`. Пользовательские схемы и контексты можно складывать в `services/ai_sb/app/assets/users_assets/`.
